---
title: 24点
tags: Python
excerpt: 24点解题代码
abbrlink: 752f44c9
date: 2024-5-3 12:00:00
---

## 24点简介
24点游戏是对4个数字进行加、减、乘、除四则运算（可以加括号），使计算结果等于24的小游戏。这4个数字从一副抽去大小王的扑克牌抽取，数字范围是1~13，其中J、Q、K分别代表11、12、13。

## 算法
1. 输入4个数字作为24点的题目
2. 生成数字的所有可能排列并去重，生成运算符的所有可能序列
3. 生成表达式的所有括号组合
用a,b,c,d代表数字，op1,op2,op3代表运算符，括号组合包括以下5种：
```txt
((a op1 b) op2 c) op3 d,
(a op1 (b op2 c)) op3 d,
(a op1 b) op2 (c op3 d),
a op1 ((b op2 c) op3 d),
a op1 (b op2 (c op3 d))
```
4. 验证表达式是否等于24，注意浮点数精度问题和除以零报错
5. 记录表达式的最后一次运算，对解法进行分类，去除包含负值或左边值小于右边值的解法
6. 输出解法

## Python解题代码
```Python
import itertools


def generate_expressions(numbers, operators):
    """生成表达式的所有括号组合"""
    a, b, c, d = numbers
    op1, op2, op3 = operators

    expressions = [
        f"(({a}{op1}{b}){op2}{c}){op3}{d}",
        f"({a}{op1}({b}{op2}{c})){op3}{d}",
        f"({a}{op1}{b}){op2}({c}{op3}{d})",
        f"{a}{op1}(({b}{op2}{c}){op3}{d})",
        f"{a}{op1}({b}{op2}({c}{op3}{d}))",
    ]

    return expressions


def is_solution(expr):
    """验证表达式是否等于24"""
    try:
        return abs(eval(expr) - 24) < 1e-6
    except ZeroDivisionError:
        return False


def format_number(num):
    """格式化浮点数，去掉多余的0"""
    return str(int(num)) if num.is_integer() else str(round(num, 6))


def parse_expression(numbers, operators, index):
    """解析表达式，记录最后一次运算"""
    a, b, c, d = numbers
    op1, op2, op3 = operators

    match index:
        case 0:
            number_l = eval(f"({a}{op1}{b}){op2}{c}")
            number_r = d
            op = op3
        case 1:
            number_l = eval(f"{a}{op1}({b}{op2}{c})")
            number_r = d
            op = op3
        case 2:
            number_l = eval(f"{a}{op1}{b}")
            number_r = eval(f"{c}{op3}{d}")
            op = op2
        case 3:
            number_l = a
            number_r = eval(f"({b}{op2}{c}){op3}{d}")
            op = op1
        case 4:
            number_l = a
            number_r = eval(f"{b}{op2}({c}{op3}{d})")
            op = op1

    has_negative = number_l < 0 or number_r < 0
    left_smaller_than_right = number_l < number_r

    if has_negative or left_smaller_than_right:
        return None

    formatted_l = format_number(number_l)
    formatted_r = format_number(number_r)

    return f"{formatted_l} {op} {formatted_r}"


def solve(numbers):
    """解决24点问题的主函数"""
    # 生成所有数字排列并去重
    number_permutations = list(set(itertools.permutations(numbers)))

    # 生成运算符的所有可能序列
    operators = ["+", "-", "*", "/"]
    operator_sequences = list(itertools.product(operators, repeat=3))

    solutions = {}

    for nums in number_permutations:
        for ops in operator_sequences:
            # 生成表达式的所有括号组合
            expressions = generate_expressions(nums, ops)

            # 验证表达式是否等于24
            for i, expr in enumerate(expressions):
                if is_solution(expr):
                    last_operation = parse_expression(nums, ops, i)
                    if last_operation is not None and last_operation not in solutions:
                        solutions[last_operation] = expr

    # 输出所有解法
    if not solutions:
        print("没有找到解法")
    else:
        print("找到以下解法：")
        for last_operation, expr in solutions.items():
            print(f"{last_operation}型：{expr}")


if __name__ == "__main__":
    question = input("请输入4个数字（用空格分隔）：").split()
    numbers = [int(x) for x in question]
    solve(numbers)

```

## 测试一下
```txt
请输入4个数字（用空格分隔）：2 3 5 12
找到以下解法：
12 / 0.5型：12/(3-(5/2))
```